(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[702],{2065:function(e,s,t){Promise.resolve().then(t.bind(t,441))},7648:function(e,s,t){"use strict";t.d(s,{default:function(){return r.a}});var a=t(2972),r=t.n(a)},9376:function(e,s,t){"use strict";var a=t(5475);t.o(a,"redirect")&&t.d(s,{redirect:function(){return a.redirect}}),t.o(a,"usePathname")&&t.d(s,{usePathname:function(){return a.usePathname}}),t.o(a,"useRouter")&&t.d(s,{useRouter:function(){return a.useRouter}}),t.o(a,"useSearchParams")&&t.d(s,{useSearchParams:function(){return a.useSearchParams}})},441:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return c}});var a=t(7437),r=t(2265),l=t(605),i=t(9376),n=t(7648);function c(){var e,s;let{data:t,status:c}=(0,l.useSession)(),[d,o]=(0,r.useState)(null),[x,h]=(0,r.useState)([]),[m,u]=(0,r.useState)({totalDonated:0,totalDonations:0}),[g,b]=(0,r.useState)(!0),[p,y]=(0,r.useState)(""),[j,f]=(0,r.useState)(null),[N,v]=(0,r.useState)("pending");(0,r.useEffect)(()=>{if("loading"!==c){if(!t){(0,i.redirect)("/auth/signin");return}D(),w()}},[t,c]);let w=()=>{navigator.geolocation?navigator.geolocation.getCurrentPosition(e=>{v("granted"),C(e.coords.latitude,e.coords.longitude)},e=>{console.warn("Location access denied:",e),v("denied"),C()}):(v("denied"),C())},D=async()=>{try{b(!0);let e=await fetch("/api/subscriptions"),s=await e.json();o(s);let t=await fetch("/api/donations"),a=await t.json();h(a.donations||[]),u(a.summary||{totalDonated:0,totalDonations:0})}catch(e){y("Failed to load dashboard data"),console.error("Dashboard error:",e)}finally{b(!1)}},C=async(e,s)=>{try{let t=await fetch("/api/missing-persons?limit=10000"),a=await t.json(),r=a.data||a,l=null,i=[],n={city:"Unknown",state:"US",totalMissing:0,children:0,recentlyReported:0};if(e&&s)try{let t=await fetch("https://api.bigdatacloud.net/data/reverse-geocode-client?latitude=".concat(e,"&longitude=").concat(s,"&localityLanguage=en")),a=await t.json();l={latitude:e,longitude:s,city:a.city||a.locality||"Unknown",state:a.principalSubdivision||"Unknown"},i=r.filter(t=>!!t.latitude&&!!t.longitude&&!!t.age&&100>=A(e,s,t.latitude,t.longitude)&&t.age<18);let c=r.filter(e=>e.location.toLowerCase().includes(l.state.toLowerCase()));n={city:l.city,state:l.state,totalMissing:c.length,children:c.filter(e=>e.age&&e.age<18).length,recentlyReported:c.filter(e=>{let s=new Date(e.date),t=new Date;return t.setDate(t.getDate()-30),s>t}).length}}catch(e){console.error("Geocoding error:",e)}let c=new Date;c.setDate(c.getDate()-7);let d=r.filter(e=>new Date(e.date)>c).slice(0,10),o=r.filter(e=>e.age&&e.age<12).slice(0,5);f({nearbyMissingChildren:i,recentCases:d,criticalCases:o,locationStats:n,userLocation:l})}catch(e){console.error("Error fetching crisis data:",e)}},A=(e,s,t,a)=>{let r=(t-e)*Math.PI/180,l=(a-s)*Math.PI/180,i=Math.sin(r/2)*Math.sin(r/2)+Math.cos(e*Math.PI/180)*Math.cos(t*Math.PI/180)*Math.sin(l/2)*Math.sin(l/2);return 2*Math.atan2(Math.sqrt(i),Math.sqrt(1-i))*3959},S=async()=>{if(confirm("Are you sure you want to cancel your subscription? It will remain active until the end of your current billing period."))try{let e=await fetch("/api/subscriptions",{method:"DELETE"});if(e.ok)D(),alert("Subscription will be canceled at the end of the current period.");else{let s=await e.json();alert("Error: ".concat(s.error))}}catch(e){alert("Failed to cancel subscription")}},M=async()=>{try{let e=await fetch("/api/subscriptions",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"reactivate"})});if(e.ok)D(),alert("Subscription reactivated successfully!");else{let s=await e.json();alert("Error: ".concat(s.error))}}catch(e){alert("Failed to reactivate subscription")}},k=(()=>{let e=Math.floor(m.totalDonated/.5);return{aiSearchesFunded:e,alertsSent:Math.floor(m.totalDonated/2),casesAnalyzed:Math.min(100,Math.floor(m.totalDonated/1)),crisisResponseHours:Math.floor(m.totalDonated/5)}})();return"loading"===c||g?(0,a.jsx)("div",{className:"min-h-screen bg-black text-white flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto mb-4"}),(0,a.jsx)("p",{children:"Loading dashboard..."})]})}):t?(0,a.jsxs)("div",{className:"min-h-screen bg-black text-white",children:[(0,a.jsx)("header",{className:"bg-gray-900 border-b border-gray-800 py-6",children:(0,a.jsxs)("div",{className:"container mx-auto px-4 flex justify-between items-center",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-white",children:"Crisis Response Center"}),(0,a.jsxs)("div",{className:"mt-2 space-y-1",children:[(null==j?void 0:j.userLocation)?(0,a.jsxs)("p",{className:"text-blue-400 font-semibold",children:["\uD83D\uDCCD Your Location: ",j.userLocation.city,", ",j.userLocation.state]}):"pending"===N?(0,a.jsx)("p",{className:"text-yellow-400 text-sm",children:"\uD83D\uDD04 Getting your location for local crisis data..."}):(0,a.jsxs)("p",{className:"text-gray-400 text-sm",children:["\uD83D\uDCCD Location access needed for local crisis alerts",(0,a.jsx)("button",{onClick:w,className:"ml-2 underline hover:text-white",children:"Enable Location"})]}),(0,a.jsxs)("p",{className:"text-gray-300",children:["Welcome back, ",(null===(e=t.user)||void 0===e?void 0:e.name)||(null===(s=t.user)||void 0===s?void 0:s.email)]}),(0,a.jsx)("p",{className:"text-red-400 text-sm",children:"\uD83D\uDEA8 Real-time crisis monitoring active"})]})]}),(0,a.jsxs)("nav",{className:"hidden md:flex gap-6",children:[(0,a.jsx)(n.default,{href:"/",className:"text-gray-300 hover:text-white transition-colors",children:"Home"}),(0,a.jsx)(n.default,{href:"/about",className:"text-gray-300 hover:text-white transition-colors",children:"About"}),(0,a.jsx)(n.default,{href:"/analysis",className:"text-gray-300 hover:text-white transition-colors",children:"AI Analysis"}),(0,a.jsx)(n.default,{href:"/dashboard",className:"text-white font-semibold",children:"Dashboard"}),(0,a.jsx)(n.default,{href:"/profile",className:"text-gray-300 hover:text-white transition-colors",children:"Profile"}),(0,a.jsx)(n.default,{href:"/auth/signin",className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition-colors",children:"Sign In"})]})]})}),(0,a.jsxs)("main",{className:"container mx-auto px-4 py-8",children:[p&&(0,a.jsx)("div",{className:"bg-red-900 border border-red-700 text-red-200 px-4 py-3 rounded mb-6",children:p}),j&&(0,a.jsx)("div",{className:"bg-gradient-to-r from-red-900/40 to-red-800/40 border border-red-700 rounded-lg p-4 mb-8",children:(0,a.jsxs)("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsxs)("div",{className:"text-red-400",children:[(0,a.jsx)("span",{className:"text-2xl font-bold",children:j.nearbyMissingChildren.length}),(0,a.jsx)("span",{className:"text-sm ml-2",children:"missing children within 100 miles of you"})]}),j.criticalCases.length>0&&(0,a.jsxs)("div",{className:"text-yellow-500 text-sm",children:[j.criticalCases.length," critical cases (children under 12)"]})]}),(0,a.jsxs)("div",{className:"flex gap-3",children:[(0,a.jsx)(n.default,{href:"/",className:"bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg text-sm font-semibold transition-colors",children:"View Crisis Map"}),(0,a.jsx)(n.default,{href:"/donate",className:"bg-yellow-600 hover:bg-yellow-700 text-white px-4 py-2 rounded-lg text-sm font-semibold transition-colors",children:"Fund Search Technology"}),(0,a.jsx)(n.default,{href:"/analysis",className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm font-semibold transition-colors",children:"AI Analysis"})]})]})}),j&&(0,a.jsx)(a.Fragment,{children:(0,a.jsxs)("div",{className:"grid md:grid-cols-3 gap-6 mb-8",children:[(0,a.jsxs)("div",{className:"bg-gray-900 border border-gray-800 rounded-lg p-6",children:[(0,a.jsx)("h3",{className:"text-xl font-semibold text-red-400 mb-4",children:"\uD83C\uDFE0 Your Area Crisis"}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("span",{className:"text-gray-400",children:["In ",j.locationStats.state,":"]}),(0,a.jsxs)("span",{className:"ml-2 font-semibold text-white",children:[j.locationStats.totalMissing," total missing"]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-400",children:"Children missing:"}),(0,a.jsx)("span",{className:"ml-2 font-semibold text-red-400",children:j.locationStats.children})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-400",children:"Recently reported:"}),(0,a.jsxs)("span",{className:"ml-2 font-semibold text-yellow-400",children:[j.locationStats.recentlyReported," (last 30 days)"]})]})]})]}),(0,a.jsxs)("div",{className:"bg-gray-900 border border-gray-800 rounded-lg p-6",children:[(0,a.jsx)("h3",{className:"text-xl font-semibold text-blue-400 mb-4",children:"\uD83D\uDCB0 Your Impact"}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-400",children:"AI Searches Funded:"}),(0,a.jsx)("span",{className:"ml-2 font-semibold text-yellow-400",children:k.aiSearchesFunded})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-400",children:"Critical Alerts Sent:"}),(0,a.jsx)("span",{className:"ml-2 font-semibold text-red-400",children:k.alertsSent})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-400",children:"Technology Hours Funded:"}),(0,a.jsxs)("span",{className:"ml-2 font-semibold text-green-400",children:[k.crisisResponseHours,"h"]})]})]})]}),(0,a.jsxs)("div",{className:"bg-gray-900 border border-gray-800 rounded-lg p-6",children:[(0,a.jsx)("h3",{className:"text-xl font-semibold text-purple-400 mb-4",children:"⚡ Quick Actions"}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("button",{onClick:()=>window.open("/","_blank"),className:"w-full bg-red-600 hover:bg-red-700 text-white py-2 rounded text-sm",children:"View Local Cases"}),(0,a.jsx)("button",{onClick:()=>window.open("/analysis","_blank"),className:"w-full bg-blue-600 hover:bg-blue-700 text-white py-2 rounded text-sm",children:"Run AI Analysis"}),(0,a.jsx)("button",{onClick:()=>window.open("/donate","_blank"),className:"w-full bg-yellow-600 hover:bg-yellow-700 text-white py-2 rounded text-sm",children:"Emergency Funding"})]})]})]})}),j&&(0,a.jsxs)("div",{className:"grid md:grid-cols-2 gap-6 mb-8",children:[(0,a.jsxs)("div",{className:"bg-gradient-to-br from-red-950/50 to-gray-900 border border-red-800 rounded-lg p-6",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold text-white mb-4",children:"\uD83D\uDEA8 Critical Cases (Under 12)"}),j.criticalCases.length>0?(0,a.jsxs)("div",{className:"space-y-3",children:[j.criticalCases.map((e,s)=>(0,a.jsx)("div",{className:"bg-black/30 border border-red-700 rounded-lg p-3",children:(0,a.jsxs)("div",{className:"flex justify-between items-start",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-white font-semibold",children:e.name}),(0,a.jsxs)("p",{className:"text-red-400 text-sm",children:["Age: ",e.age]}),(0,a.jsx)("p",{className:"text-gray-300 text-xs",children:e.location}),(0,a.jsxs)("p",{className:"text-yellow-400 text-xs",children:["Reported: ",e.date]})]}),(0,a.jsx)("button",{onClick:()=>navigator.share?navigator.share({title:"Help find ".concat(e.name),text:"".concat(e.name,", age ").concat(e.age,", missing from ").concat(e.location),url:window.location.origin}):navigator.clipboard.writeText("Help find ".concat(e.name,", age ").concat(e.age,", missing from ").concat(e.location)),className:"bg-red-600 hover:bg-red-700 text-white px-2 py-1 rounded text-xs",children:"Share"})]})},e.id)),(0,a.jsx)(n.default,{href:"/",className:"block w-full text-center bg-red-600 hover:bg-red-700 text-white py-2 rounded-lg text-sm font-semibold",children:"View All Cases on Map"})]}):(0,a.jsxs)("div",{className:"text-center py-8",children:[(0,a.jsx)("p",{className:"text-gray-400",children:"No critical cases in your immediate area"}),(0,a.jsx)("p",{className:"text-green-400 text-sm mt-2",children:"This is good news!"})]})]}),(0,a.jsxs)("div",{className:"bg-gradient-to-br from-blue-950/50 to-gray-900 border border-blue-800 rounded-lg p-6",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold text-white mb-4",children:"\uD83D\uDCCD Missing Children Near You"}),"granted"===N&&j.nearbyMissingChildren.length>0?(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsx)("div",{className:"text-blue-400 text-sm mb-4",children:"Within 100 miles of your location"}),j.nearbyMissingChildren.slice(0,3).map(e=>(0,a.jsx)("div",{className:"bg-black/30 border border-blue-700 rounded-lg p-3",children:(0,a.jsx)("div",{className:"flex justify-between items-start",children:(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-white font-semibold",children:e.name}),(0,a.jsxs)("p",{className:"text-blue-400 text-sm",children:["Age: ",e.age]}),(0,a.jsx)("p",{className:"text-gray-300 text-xs",children:e.location}),e.latitude&&e.longitude&&j.userLocation&&(0,a.jsxs)("p",{className:"text-yellow-400 text-xs",children:["Distance: ",Math.round(A(j.userLocation.latitude,j.userLocation.longitude,e.latitude,e.longitude))," miles away"]})]})})},e.id)),j.nearbyMissingChildren.length>3&&(0,a.jsxs)("div",{className:"text-center text-blue-400 text-sm",children:["+ ",j.nearbyMissingChildren.length-3," more nearby"]})]}):"denied"===N?(0,a.jsxs)("div",{className:"text-center py-8",children:[(0,a.jsx)("p",{className:"text-gray-400 mb-4",children:"Enable location access to see missing children near you"}),(0,a.jsx)("button",{onClick:w,className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm",children:"Enable Location Access"})]}):(0,a.jsx)("div",{className:"text-center py-8",children:(0,a.jsx)("div",{className:"animate-pulse",children:(0,a.jsx)("p",{className:"text-yellow-400",children:"\uD83D\uDD04 Getting your location..."})})})]})]}),j&&j.recentCases.length>0&&(0,a.jsxs)("div",{className:"bg-gray-900 border border-gray-800 rounded-lg p-6 mb-8",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold text-white",children:"\uD83D\uDCC5 Recently Reported Cases"}),(0,a.jsx)("span",{className:"text-gray-400 text-sm",children:"Last 7 days"})]}),(0,a.jsx)("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-4",children:j.recentCases.map(e=>(0,a.jsxs)("div",{className:"bg-gray-800 border border-gray-700 rounded-lg p-4",children:[(0,a.jsxs)("div",{className:"flex justify-between items-start mb-2",children:[(0,a.jsx)("h3",{className:"font-semibold text-white",children:e.name}),e.age&&e.age<18&&(0,a.jsx)("span",{className:"bg-red-600 text-white px-2 py-1 rounded text-xs",children:"Child"})]}),(0,a.jsxs)("div",{className:"space-y-1 text-sm",children:[e.age&&(0,a.jsxs)("p",{className:"text-blue-400",children:["Age: ",e.age]}),(0,a.jsx)("p",{className:"text-gray-300",children:e.location}),(0,a.jsxs)("p",{className:"text-yellow-400",children:["Reported: ",e.date]})]}),(0,a.jsx)("div",{className:"mt-3 flex gap-2",children:(0,a.jsx)("button",{onClick:()=>navigator.share?navigator.share({title:"Help find ".concat(e.name),text:"".concat(e.name).concat(e.age?", age ".concat(e.age):"",", missing from ").concat(e.location),url:window.location.origin}):navigator.clipboard.writeText("Help find ".concat(e.name).concat(e.age?", age ".concat(e.age):"",", missing from ").concat(e.location)),className:"bg-blue-600 hover:bg-blue-700 text-white px-2 py-1 rounded text-xs",children:"Share"})})]},e.id))}),(0,a.jsx)("div",{className:"mt-6 text-center",children:(0,a.jsx)(n.default,{href:"/",className:"bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg text-sm font-semibold",children:"View All Cases on Interactive Map"})})]}),d&&(0,a.jsxs)("div",{className:"bg-gray-900 border border-gray-800 rounded-lg p-6 mb-8",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Subscription"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"font-semibold mb-3",children:"Current Plan"}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-400",children:"Tier:"}),(0,a.jsx)("span",{className:"ml-2 capitalize font-semibold text-blue-400",children:d.tier})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-400",children:"Status:"}),(0,a.jsx)("span",{className:"ml-2 capitalize ".concat("active"===d.status?"text-green-400":"text-yellow-400"),children:d.status})]}),d.currentPeriodEnd&&(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-400",children:"Renews:"}),(0,a.jsx)("span",{className:"ml-2",children:new Date(d.currentPeriodEnd).toLocaleDateString()})]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"font-semibold mb-3",children:"Features"}),(0,a.jsxs)("ul",{className:"space-y-1 text-sm",children:[(0,a.jsxs)("li",{className:"text-gray-300",children:["\uD83D\uDDFA️ Map Access: ",d.mapAccessLevel]}),(0,a.jsxs)("li",{className:"text-gray-300",children:["\uD83E\uDD16 AI Interactions: ",-1===d.aiInteractionsPerDay?"Unlimited":"".concat(d.aiInteractionsPerDay,"/day")]}),d.features&&Array.isArray(d.features)&&d.features.includes("no_ads")&&(0,a.jsx)("li",{className:"text-green-400",children:"✅ Ad-free experience"}),d.features&&Array.isArray(d.features)&&d.features.includes("priority_support")&&(0,a.jsx)("li",{className:"text-green-400",children:"✅ Priority support"}),d.features&&Array.isArray(d.features)&&d.features.includes("advanced_analytics")&&(0,a.jsx)("li",{className:"text-green-400",children:"✅ Advanced analytics"}),d.features&&Array.isArray(d.features)&&d.features.includes("api_access")&&(0,a.jsx)("li",{className:"text-green-400",children:"✅ API access"})]})]})]}),(0,a.jsxs)("div",{className:"mt-6 flex gap-4",children:["free"!==d.tier&&(0,a.jsx)(a.Fragment,{children:d.cancelAtPeriodEnd?(0,a.jsx)("button",{onClick:M,className:"bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg transition-colors",children:"Reactivate Subscription"}):(0,a.jsx)("button",{onClick:S,className:"bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg transition-colors",children:"Cancel Subscription"})}),(0,a.jsx)(n.default,{href:"/pricing",className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition-colors",children:"free"===d.tier?"Upgrade Plan":"Change Plan"})]})]}),(0,a.jsxs)("div",{className:"bg-gray-900 border border-gray-800 rounded-lg p-6",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Recent Donations"}),x.length>0?(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"w-full text-sm",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{className:"border-b border-gray-700",children:[(0,a.jsx)("th",{className:"text-left py-2",children:"Date"}),(0,a.jsx)("th",{className:"text-left py-2",children:"Amount"}),(0,a.jsx)("th",{className:"text-left py-2",children:"Type"}),(0,a.jsx)("th",{className:"text-left py-2",children:"Anonymous"})]})}),(0,a.jsx)("tbody",{children:x.slice(0,5).map(e=>(0,a.jsxs)("tr",{className:"border-b border-gray-800",children:[(0,a.jsx)("td",{className:"py-2",children:new Date(e.createdAt).toLocaleDateString()}),(0,a.jsxs)("td",{className:"py-2 font-semibold text-green-400",children:["$",e.amount.toFixed(2)]}),(0,a.jsx)("td",{className:"py-2 capitalize",children:e.donationType.replace("_"," ")}),(0,a.jsx)("td",{className:"py-2",children:e.anonymous?"Yes":"No"})]},e.id))})]})}):(0,a.jsxs)("div",{className:"text-center py-8 text-gray-400",children:[(0,a.jsx)("p",{children:"No donations yet"}),(0,a.jsx)(n.default,{href:"/donate",className:"inline-block mt-4 bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg transition-colors",children:"Make Your First Donation"})]})]})]})]}):null}}},function(e){e.O(0,[972,605,971,117,744],function(){return e(e.s=2065)}),_N_E=e.O()}]);