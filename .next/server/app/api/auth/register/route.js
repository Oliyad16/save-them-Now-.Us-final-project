"use strict";(()=>{var e={};e.id=2,e.ids=[2],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},84770:e=>{e.exports=require("crypto")},92048:e=>{e.exports=require("fs")},55315:e=>{e.exports=require("path")},4318:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>T,patchFetch:()=>x,requestAsyncStorage:()=>R,routeModule:()=>h,serverHooks:()=>v,staticGenerationAsyncStorage:()=>_});var s={};t.r(s),t.d(s,{GET:()=>g,POST:()=>E});var a=t(49303),n=t(88716),i=t(60670),o=t(87070),u=t(98691),l=t(42729);let c=require("node:crypto"),p={randomUUID:c.randomUUID},d=new Uint8Array(256),m=d.length,f=[];for(let e=0;e<256;++e)f.push((e+256).toString(16).slice(1));async function E(e){try{var r,t;let{email:s,password:a,name:n,zipCode:i}=await e.json();if(!s||!a||!n)return o.NextResponse.json({error:"Email, password, and name are required"},{status:400});if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(s))return o.NextResponse.json({error:"Invalid email format"},{status:400});if(a.length<8)return o.NextResponse.json({error:"Password must be at least 8 characters long"},{status:400});let E=(0,l.N)();if(E.prepare("SELECT id FROM users WHERE email = ?").get(s))return o.NextResponse.json({error:"User with this email already exists"},{status:409});let g=await u.ZP.hash(a,12),h=p.randomUUID?p.randomUUID():function(e,r,t){let s=(e=e||{}).random??e.rng?.()??(m>d.length-16&&((0,c.randomFillSync)(d),m=0),d.slice(m,m+=16));if(s.length<16)throw Error("Random bytes length must be >= 16");if(s[6]=15&s[6]|64,s[8]=63&s[8]|128,r){if((t=t||0)<0||t+16>r.length)throw RangeError(`UUID byte range ${t}:${t+15} is out of buffer bounds`);for(let e=0;e<16;++e)r[t+e]=s[e];return r}return function(e,r=0){return(f[e[r+0]]+f[e[r+1]]+f[e[r+2]]+f[e[r+3]]+"-"+f[e[r+4]]+f[e[r+5]]+"-"+f[e[r+6]]+f[e[r+7]]+"-"+f[e[r+8]]+f[e[r+9]]+"-"+f[e[r+10]]+f[e[r+11]]+f[e[r+12]]+f[e[r+13]]+f[e[r+14]]+f[e[r+15]]).toLowerCase()}(s)}(r,t,void 0),R=E.prepare(`
      INSERT INTO users (
        id, email, name, password_hash, tier, email_verified,
        createdAt, updatedAt
      ) VALUES (?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP)
    `),_=E.prepare(`
      INSERT INTO user_profiles (
        user_id, zip_code, onboarding_completed,
        created_at, updated_at
      ) VALUES (?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP)
    `);return E.transaction(()=>{R.run(h,s,n,g,"free",1),_.run(h,i||null,0)})(),o.NextResponse.json({success:!0,message:"Account created successfully! You can now sign in.",userId:h},{status:201})}catch(e){return console.error("Registration error:",e),o.NextResponse.json({error:"Internal server error"},{status:500})}}async function g(e){let{searchParams:r}=new URL(e.url),t=r.get("token"),s=r.get("email");if(!t||!s)return o.NextResponse.json({error:"Missing verification token or email"},{status:400});try{let e=(0,l.N)(),r=e.prepare(`
      SELECT id, email_verification_token, verification_expires_at 
      FROM users 
      WHERE email = ? AND email_verification_token = ?
    `).get(s,t);if(!r)return o.NextResponse.json({error:"Invalid verification token"},{status:400});let a=new Date,n=new Date(r.verification_expires_at);if(a>n)return o.NextResponse.json({error:"Verification token has expired"},{status:400});return e.prepare(`
      UPDATE users 
      SET email_verified = 1, 
          email_verification_token = NULL, 
          verification_expires_at = NULL,
          updated_at = CURRENT_TIMESTAMP
      WHERE id = ?
    `).run(r.id),e.prepare(`
      INSERT INTO user_activity (user_id, activity_type, activity_data) 
      VALUES (?, 'email_verified', '{}')
    `).run(r.id),o.NextResponse.json({message:"Email verified successfully"},{status:200})}catch(e){return console.error("Email verification error:",e),o.NextResponse.json({error:"Internal server error"},{status:500})}}let h=new a.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/auth/register/route",pathname:"/api/auth/register",filename:"route",bundlePath:"app/api/auth/register/route"},resolvedPagePath:"E:\\Download\\savethemnow.Jesus\\src\\app\\api\\auth\\register\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:R,staticGenerationAsyncStorage:_,serverHooks:v}=h,T="/api/auth/register/route";function x(){return(0,i.patchFetch)({serverHooks:v,staticGenerationAsyncStorage:_})}},42729:(e,r,t)=>{t.d(r,{N:()=>d});let s=require("better-sqlite3");var a=t.n(s),n=t(92048),i=t.n(n),o=t(55315),u=t.n(o);let l=process.env.DATABASE_PATH||u().join(process.cwd(),"database.sqlite"),c=u().join(process.cwd(),"src/lib/database/schema.sql"),p=null;function d(){if(!p){let e=u().dirname(l);i().existsSync(e)||i().mkdirSync(e,{recursive:!0}),(p=new(a())(l)).pragma("journal_mode = WAL"),p.pragma("foreign_keys = ON"),p&&(p.prepare("SELECT name FROM sqlite_master WHERE type='table' AND name='users'").get()||(console.log("Initializing database schema..."),i().existsSync(c)?(i().readFileSync(c,"utf8").split(";").filter(e=>e.trim()).forEach(e=>{try{p.exec(e)}catch(e){console.error("Error executing schema statement:",e)}}),console.log("Database schema initialized successfully")):console.error("Schema file not found at:",c)))}return p}function m(){p&&(p.close(),p=null)}process.on("SIGINT",m),process.on("SIGTERM",m)}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[276,972,691],()=>t(4318));module.exports=s})();