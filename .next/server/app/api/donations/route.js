"use strict";(()=>{var e={};e.id=922,e.ids=[922],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},27790:e=>{e.exports=require("assert")},78893:e=>{e.exports=require("buffer")},61282:e=>{e.exports=require("child_process")},84770:e=>{e.exports=require("crypto")},17702:e=>{e.exports=require("events")},92048:e=>{e.exports=require("fs")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},55315:e=>{e.exports=require("path")},86624:e=>{e.exports=require("querystring")},17360:e=>{e.exports=require("url")},21764:e=>{e.exports=require("util")},71568:e=>{e.exports=require("zlib")},75389:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>I,patchFetch:()=>h,requestAsyncStorage:()=>R,routeModule:()=>E,serverHooks:()=>S,staticGenerationAsyncStorage:()=>y});var s={};r.r(s),r.d(s,{GET:()=>_,POST:()=>d,PUT:()=>m});var n=r(49303),o=r(88716),a=r(60670),i=r(87070),u=r(45609),c=r(67024),l=r(69234),p=r(42729);async function d(e){try{let{amount:t,donationType:r,anonymous:s,message:n,email:o}=await e.json();if(!t||t<1)return i.NextResponse.json({error:"Amount must be at least $1"},{status:400});let a=await (0,u.getServerSession)(c.a),d=a?.user?.email,_=o||a?.user?.email;if(!_)return i.NextResponse.json({error:"Email is required for donations"},{status:400});let m=(0,p.N)();if(!l.A)return i.NextResponse.json({error:"Payment processing is not configured"},{status:503});let E=await l.A.paymentIntents.create({amount:Math.round(100*t),currency:"usd",metadata:{type:"donation",donation_type:r||"general",user_id:d||"",anonymous:s?"true":"false",message:n||""},receipt_email:s?void 0:_,description:`Donation to SaveThemNow.Jesus - ${r||"General Support"}`}),R=m.prepare(`
      INSERT INTO donations (
        user_id, email, amount, donation_type, anonymous, message, stripe_payment_intent_id
      ) VALUES (?, ?, ?, ?, ?, ?, ?)
    `).run(d||null,_,t,r||"general",s?1:0,n||null,E.id).lastInsertRowid;return i.NextResponse.json({clientSecret:E.client_secret,donationId:R,amount:t})}catch(e){return console.error("Error creating donation:",e),i.NextResponse.json({error:"Failed to create donation"},{status:500})}}async function _(e){try{let t=await (0,u.getServerSession)(c.a);if(!t?.user?.email)return i.NextResponse.json({error:"Authentication required"},{status:401});let{searchParams:r}=new URL(e.url),s=Math.min(parseInt(r.get("limit")||"10"),100),n=parseInt(r.get("offset")||"0");(0,p.N)();let o={count:0,total_amount:0};return i.NextResponse.json({donations:[],pagination:{limit:s,offset:n,total:o.count||0},summary:{totalDonated:o.total_amount||0,totalDonations:o.count||0}})}catch(e){return console.error("Error fetching donations:",e),i.NextResponse.json({error:"Failed to fetch donations"},{status:500})}}async function m(e){try{let{amount:t,donationType:r,successUrl:s,cancelUrl:n}=await e.json();if(!t||t<1)return i.NextResponse.json({error:"Amount must be at least $1"},{status:400});let o=await (0,u.getServerSession)(c.a),a=o?.user?.email;if(!l.A)return i.NextResponse.json({error:"Payment processing is not configured"},{status:503});let p=await l.A.checkout.sessions.create({payment_method_types:["card"],line_items:[{price_data:{currency:"usd",product_data:{name:`SaveThemNow.Jesus Donation - ${r||"General Support"}`,description:"Help us locate missing persons and save lives"},unit_amount:Math.round(100*t)},quantity:1}],mode:"payment",success_url:s||`${process.env.SITE_URL}/donation-success?session_id={CHECKOUT_SESSION_ID}`,cancel_url:n||`${process.env.SITE_URL}/donate`,metadata:{type:"donation",donation_type:r||"general",user_id:a||""},allow_promotion_codes:!1});return i.NextResponse.json({sessionId:p.id,url:p.url})}catch(e){return console.error("Error creating donation checkout:",e),i.NextResponse.json({error:"Failed to create donation checkout"},{status:500})}}let E=new n.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/donations/route",pathname:"/api/donations",filename:"route",bundlePath:"app/api/donations/route"},resolvedPagePath:"E:\\Download\\savethemnow.Jesus\\src\\app\\api\\donations\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:R,staticGenerationAsyncStorage:y,serverHooks:S}=E,I="/api/donations/route";function h(){return(0,a.patchFetch)({serverHooks:S,staticGenerationAsyncStorage:y})}},67024:(e,t,r)=>{r.d(t,{a:()=>i});var s=r(53797),n=r(77234),o=r(42729),a=r(98691);let i={providers:[(0,s.Z)({id:"credentials",name:"Email and Password",credentials:{email:{label:"Email",type:"email"},password:{label:"Password",type:"password"}},async authorize(e){if(!e?.email||!e?.password)return null;let t=(0,o.N)(),r=t.prepare("SELECT id, email, password_hash, name, tier, email_verified FROM users WHERE email = ?").get(e.email);return r&&r.password_hash&&await a.ZP.compare(e.password,r.password_hash)?(t.prepare("UPDATE users SET last_login = CURRENT_TIMESTAMP WHERE id = ?").run(r.id),{id:r.id.toString(),email:r.email,name:r.name,tier:r.tier,emailVerified:r.email_verified}):null}}),...process.env.GOOGLE_CLIENT_ID&&process.env.GOOGLE_CLIENT_SECRET?[(0,n.Z)({clientId:process.env.GOOGLE_CLIENT_ID,clientSecret:process.env.GOOGLE_CLIENT_SECRET})]:[]],session:{strategy:"jwt",maxAge:2592e3,updateAge:86400},callbacks:{session:async({session:e,token:t})=>(e?.user&&t&&(e.user.id=t.sub,e.user.tier=t.tier),e),jwt:async({token:e,user:t})=>(t&&(e.id=t.id,e.tier=t.tier),e)},pages:{signIn:"/auth/signin",signUp:"/auth/signup",error:"/auth/error",verifyRequest:"/auth/verify-request"}}},42729:(e,t,r)=>{r.d(t,{N:()=>d});let s=require("better-sqlite3");var n=r.n(s),o=r(92048),a=r.n(o),i=r(55315),u=r.n(i);let c=process.env.DATABASE_PATH||u().join(process.cwd(),"database.sqlite"),l=u().join(process.cwd(),"src/lib/database/schema.sql"),p=null;function d(){if(!p){let e=u().dirname(c);a().existsSync(e)||a().mkdirSync(e,{recursive:!0}),(p=new(n())(c)).pragma("journal_mode = WAL"),p.pragma("foreign_keys = ON"),p&&(p.prepare("SELECT name FROM sqlite_master WHERE type='table' AND name='users'").get()||(console.log("Initializing database schema..."),a().existsSync(l)?(a().readFileSync(l,"utf8").split(";").filter(e=>e.trim()).forEach(e=>{try{p.exec(e)}catch(e){console.error("Error executing schema statement:",e)}}),console.log("Database schema initialized successfully")):console.error("Schema file not found at:",l)))}return p}function _(){p&&(p.close(),p=null)}process.on("SIGINT",_),process.on("SIGTERM",_)},69234:(e,t,r)=>{r.d(t,{A:()=>n,K:()=>o});var s=r(31059);let n=process.env.STRIPE_SECRET_KEY?new s.Z(process.env.STRIPE_SECRET_KEY,{apiVersion:"2024-11-20.acacia",typescript:!0}):null,o={publishableKey:process.env.STRIPE_PUBLISHABLE_KEY||"",webhookSecret:process.env.STRIPE_WEBHOOK_SECRET||"",currency:"usd",prices:{supporter_monthly:process.env.STRIPE_SUPPORTER_MONTHLY_PRICE_ID||"",supporter_yearly:process.env.STRIPE_SUPPORTER_YEARLY_PRICE_ID||"",advocate_monthly:process.env.STRIPE_ADVOCATE_MONTHLY_PRICE_ID||"",advocate_yearly:process.env.STRIPE_ADVOCATE_YEARLY_PRICE_ID||"",guardian_monthly:process.env.STRIPE_GUARDIAN_MONTHLY_PRICE_ID||"",guardian_yearly:process.env.STRIPE_GUARDIAN_YEARLY_PRICE_ID||"",hero_monthly:process.env.STRIPE_HERO_MONTHLY_PRICE_ID||"",hero_yearly:process.env.STRIPE_HERO_YEARLY_PRICE_ID||""}}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[276,972,691,830,59],()=>r(75389));module.exports=s})();