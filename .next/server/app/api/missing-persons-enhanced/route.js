"use strict";(()=>{var e={};e.id=557,e.ids=[557],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},92048:e=>{e.exports=require("fs")},55315:e=>{e.exports=require("path")},1469:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>b,patchFetch:()=>y,requestAsyncStorage:()=>g,routeModule:()=>h,serverHooks:()=>w,staticGenerationAsyncStorage:()=>E});var a={};r.r(a),r.d(a,{GET:()=>p});var n=r(49303),i=r(88716),s=r(60670),o=r(87070);let l=require("sqlite3");var u=r.n(l);r(289);var d=r(66859);async function c(e){let t=new d.v(e);return await t.open(),t}var m=r(55315),f=r.n(m);async function p(e){try{let t=f().join(process.cwd(),"database","app.db"),r=await c({filename:t,driver:u().Database}),a=e.nextUrl.searchParams,n=parseInt(a.get("limit")||"100"),i=parseInt(a.get("offset")||"0"),s=a.get("source"),l=a.get("state"),d=a.get("category"),m=`
      SELECT 
        id,
        case_number,
        name,
        age,
        gender,
        ethnicity,
        city,
        county,
        state,
        country,
        latitude,
        longitude,
        date_missing,
        date_reported,
        status,
        category,
        description,
        circumstances,
        source_name,
        data_quality_score,
        geocoding_source,
        last_verified
      FROM missing_persons_enhanced 
      WHERE 1=1
    `,p=[];s&&(m+=" AND source_name = ?",p.push(s)),l&&(m+=" AND state = ?",p.push(l.toUpperCase())),d&&(m+=" AND category = ?",p.push(d)),m+=" ORDER BY last_verified DESC, date_missing DESC LIMIT ? OFFSET ?",p.push(n,i);let h=await r.all(m,p),g="SELECT COUNT(*) as total FROM missing_persons_enhanced WHERE 1=1",E=[];s&&(g+=" AND source_name = ?",E.push(s)),l&&(g+=" AND state = ?",E.push(l.toUpperCase())),d&&(g+=" AND category = ?",E.push(d));let w=await r.get(g,E),b=w?.total||0,y=h.map((e,t)=>({id:e.id,name:e.name||"Unknown",date:e.date_missing||e.date_reported||"",status:e.status||"Active",category:e.category||"Missing Adults",reportedMissing:e.date_missing?`Reported Missing ${e.date_missing}`:"Date Unknown",location:[e.city,e.county,e.state,e.country].filter(Boolean).join(", "),latitude:e.latitude,longitude:e.longitude,age:e.age,gender:e.gender,ethnicity:e.ethnicity,description:e.description||e.circumstances,caseNumber:e.case_number,dataSource:e.source_name,qualityScore:e.data_quality_score,geocodingSource:e.geocoding_source,lastVerified:e.last_verified})),P=await r.all(`
      SELECT source_name, COUNT(*) as count 
      FROM missing_persons_enhanced 
      GROUP BY source_name
    `);return await r.close(),o.NextResponse.json({data:y,meta:{total:b,limit:n,offset:i,hasMore:i+n<b,sources:P.reduce((e,t)=>(e[t.source_name]=t.count,e),{}),enhanced:!0,dataFreshness:new Date().toISOString()}})}catch(e){return console.error("Enhanced API Error:",e),o.NextResponse.json({error:"Failed to fetch enhanced missing persons data",details:e instanceof Error?e.message:"Unknown error"},{status:500})}}let h=new n.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/missing-persons-enhanced/route",pathname:"/api/missing-persons-enhanced",filename:"route",bundlePath:"app/api/missing-persons-enhanced/route"},resolvedPagePath:"E:\\Download\\savethemnow.Jesus\\src\\app\\api\\missing-persons-enhanced\\route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:g,staticGenerationAsyncStorage:E,serverHooks:w}=h,b="/api/missing-persons-enhanced/route";function y(){return(0,s.patchFetch)({serverHooks:w,staticGenerationAsyncStorage:E})}},66859:(e,t,r)=>{t.v=void 0;let a=r(289),n=r(54688),i=r(25781),s=r(86291);class o{constructor(e){this.config=e,this.db=null}on(e,t){this.db.on(e,t)}getDatabaseInstance(){return this.db}open(){return new Promise((e,t)=>{let{filename:r,mode:a,driver:n}=this.config;if(null==r)throw Error("sqlite: filename cannot be null / undefined");if(!n)throw Error("sqlite: driver is not defined");a?this.db=new n(r,a,r=>{if(r)return t((0,s.formatError)(r));e()}):this.db=new n(r,r=>{if(r)return t((0,s.formatError)(r));e()})})}close(){return new Promise((e,t)=>{this.db.close(r=>{if(r)return t((0,s.formatError)(r));e()})})}configure(e,t){this.db.configure(e,t)}run(e,...t){return new Promise((r,n)=>{let o=(0,i.toSqlParams)(e,t);this.db.run(o.sql,...o.params,function(e){if(e)return n((0,s.formatError)(e));r({stmt:new a.Statement(this.stmt),lastID:this.lastID,changes:this.changes})})})}get(e,...t){return new Promise((r,a)=>{let n=(0,i.toSqlParams)(e,t);this.db.get(n.sql,...n.params,(e,t)=>{if(e)return a((0,s.formatError)(e));r(t)})})}each(e,...t){return new Promise((r,a)=>{let n=t.pop();if(!n||"function"!=typeof n)throw Error("sqlite: Last param of Database#each() must be a callback function");if(t.length>0){let e=t.pop();if("function"==typeof e)throw Error("sqlite: Database#each() should only have a single callback defined. See readme for usage.");t.push(e)}let o=(0,i.toSqlParams)(e,t);this.db.each(o.sql,...o.params,(e,t)=>{if(e)return n((0,s.formatError)(e),null);n(null,t)},(e,t)=>{if(e)return a((0,s.formatError)(e));r(t)})})}all(e,...t){return new Promise((r,a)=>{let n=(0,i.toSqlParams)(e,t);this.db.all(n.sql,...n.params,(e,t)=>{if(e)return a((0,s.formatError)(e));r(t)})})}exec(e){return new Promise((t,r)=>{let a=(0,i.toSqlParams)(e);this.db.exec(a.sql,e=>{if(e)return r((0,s.formatError)(e));t()})})}prepare(e,...t){return new Promise((r,n)=>{let s=(0,i.toSqlParams)(e,t),o=this.db.prepare(s.sql,...s.params,e=>{if(e)return n(e);r(new a.Statement(o))})})}loadExtension(e){return new Promise((t,r)=>{this.db.loadExtension(e,e=>{if(e)return r((0,s.formatError)(e));t()})})}async migrate(e){await (0,n.migrate)(this,e)}serialize(){throw Error("sqlite: Currently not implemented. Use getDatabaseInstance().serialize() instead.")}parallelize(){throw Error("sqlite: Currently not implemented. Use getDatabaseInstance().parallelize() instead.")}}t.v=o},289:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Statement=void 0;let a=r(86291);class n{constructor(e){this.stmt=e}getStatementInstance(){return this.stmt}bind(...e){return new Promise((t,r)=>{this.stmt.bind(...e,e=>{if(e)return r((0,a.formatError)(e));t()})})}reset(){return new Promise(e=>{this.stmt.reset(()=>{e()})})}finalize(){return new Promise((e,t)=>{this.stmt.finalize(r=>{if(r)return t((0,a.formatError)(r));e()})})}run(...e){return new Promise((t,r)=>{let n=this;this.stmt.run(...e,function(e){if(e)return r((0,a.formatError)(e));t({stmt:n,lastID:this.lastID,changes:this.changes})})})}get(...e){return new Promise((t,r)=>{this.stmt.get(...e,(e,n)=>{if(e)return r((0,a.formatError)(e));t(n)})})}all(...e){return new Promise((t,r)=>{this.stmt.all(...e,(e,n)=>{if(e)return r((0,a.formatError)(e));t(n)})})}each(...e){return new Promise((t,r)=>{let n=e.pop();if(!n||"function"!=typeof n)throw Error("sqlite: Last param of Statement#each() must be a callback function");if(e.length>0){let t=e.pop();if("function"==typeof t)throw Error("sqlite: Statement#each() should only have a single callback defined. See readme for usage.");e.push(t)}this.stmt.each(...e,(e,t)=>{if(e)return n((0,a.formatError)(e),null);n(null,t)},(e,n)=>{if(e)return r((0,a.formatError)(e));t(n)})})}}t.Statement=n},86291:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.formatError=void 0,t.formatError=function(e){if(e instanceof Error)return e;if("object"==typeof e){let t=Error();for(let r in e)t[r]=e[r];return e.message&&(t.message=e.message),t}return Error(e)}},54688:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.migrate=t.readMigrations=void 0;let a=r(92048),n=r(55315);async function i(e){let t=e||n.join(process.cwd(),"migrations"),r=n.resolve(t),i=await new Promise((e,t)=>{a.readdir(r,(r,a)=>{if(r)return t(r);e(a.map(e=>e.match(/^(\d+).(.*?)\.sql$/)).filter(e=>null!==e).map(e=>({id:Number(e[1]),name:e[2],filename:e[0]})).sort((e,t)=>Math.sign(e.id-t.id)))})});if(!i.length)throw Error(`No migration files found in '${r}'.`);return Promise.all(i.map(e=>new Promise((t,i)=>{let s=n.join(r,e.filename);a.readFile(s,"utf-8",(r,a)=>{if(r)return i(r);let[n,s]=a.split(/^--\s+?down\b/im);e.up=n.replace(/^-- .*?$/gm,"").trim(),e.down=s?s.trim():"",t(e)})})))}async function s(e,t={}){t.force=t.force||!1,t.table=t.table||"migrations";let{force:r,table:a}=t,n=t.migrations?t.migrations:await i(t.migrationsPath);await e.run(`CREATE TABLE IF NOT EXISTS "${a}" (
  id   INTEGER PRIMARY KEY,
  name TEXT    NOT NULL,
  up   TEXT    NOT NULL,
  down TEXT    NOT NULL
)`);let s=await e.all(`SELECT id, name, up, down FROM "${a}" ORDER BY id ASC`),o=n[n.length-1];for(let t of s.slice().sort((e,t)=>Math.sign(t.id-e.id)))if(!n.some(e=>e.id===t.id)||r&&t.id===o.id){await e.run("BEGIN");try{await e.exec(t.down),await e.run(`DELETE FROM "${a}" WHERE id = ?`,t.id),await e.run("COMMIT"),s=s.filter(e=>e.id!==t.id)}catch(t){throw await e.run("ROLLBACK"),t}}else break;let l=s.length?s[s.length-1].id:0;for(let t of n)if(t.id>l){await e.run("BEGIN");try{await e.exec(t.up),await e.run(`INSERT INTO "${a}" (id, name, up, down) VALUES (?, ?, ?, ?)`,t.id,t.name,t.up,t.down),await e.run("COMMIT")}catch(t){throw await e.run("ROLLBACK"),t}}}t.readMigrations=i,t.migrate=s},25781:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.toSqlParams=void 0,t.toSqlParams=function(e,t=[]){return"string"==typeof e?{sql:e,params:t}:{sql:e.sql,params:e.values}}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[276,972],()=>r(1469));module.exports=a})();