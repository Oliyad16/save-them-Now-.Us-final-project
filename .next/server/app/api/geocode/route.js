"use strict";(()=>{var e={};e.id=129,e.ids=[129],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},92048:e=>{e.exports=require("fs")},55315:e=>{e.exports=require("path")},2225:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>v,patchFetch:()=>x,requestAsyncStorage:()=>f,routeModule:()=>g,serverHooks:()=>y,staticGenerationAsyncStorage:()=>w});var o={};r.r(o),r.d(o,{GET:()=>h,POST:()=>m});var a=r(49303),s=r(88716),n=r(60670),i=r(87070),l=r(92048),c=r(55315),u=r.n(c),p=r(11915),d=r(87859);async function m(e){try{let{batchSize:t=50}=await e.json(),r=u().join(process.cwd(),"missing-persons.csv"),o=await l.promises.readFile(r,"utf-8");o.startsWith("\uFEFF")&&(o=o.slice(1));let a=(0,p.Q)(o,{columns:!0,skip_empty_lines:!0,trim:!0}),s=await (0,d.bV)(),n=new Map;for(let e of a){let t=(e.City||"").toString().trim(),r=(e.State||"").toString().trim();if(t&&r){let e=`${t},${r}`.toLowerCase();s[e]||n.has(e)||n.set(e,{city:t,state:r})}}let c=Array.from(n.values()).slice(0,t),m=[];for(let{city:e,state:t}of c){let r=await (0,d.Gu)(e,t);m.push({city:e,state:t,coordinates:r}),c.length>1&&await new Promise(e=>setTimeout(e,1e3))}return i.NextResponse.json({message:`Geocoded ${m.length} locations`,results:m,remaining:n.size-t})}catch(e){return console.error("Geocoding batch error:",e),i.NextResponse.json({error:"Failed to geocode locations"},{status:500})}}async function h(){try{let e=await (0,d.bV)(),t={totalCached:Object.keys(e).length,lastUpdated:Math.max(...Object.values(e).map(e=>e.timestamp||0))};return i.NextResponse.json(t)}catch(e){return i.NextResponse.json({error:"Failed to get geocache stats"},{status:500})}}let g=new a.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/geocode/route",pathname:"/api/geocode",filename:"route",bundlePath:"app/api/geocode/route"},resolvedPagePath:"E:\\Download\\savethemnow.Jesus\\src\\app\\api\\geocode\\route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:f,staticGenerationAsyncStorage:w,serverHooks:y}=g,v="/api/geocode/route";function x(){return(0,n.patchFetch)({serverHooks:y,staticGenerationAsyncStorage:w})}},87859:(e,t,r)=>{r.d(t,{Gu:()=>c,bV:()=>n});var o=r(92048),a=r(55315);let s=r.n(a)().join(process.cwd(),"geocache.json");async function n(){try{let e=await o.promises.readFile(s,"utf-8");return JSON.parse(e)}catch(e){return{}}}async function i(e){try{await o.promises.writeFile(s,JSON.stringify(e,null,2),"utf-8")}catch(e){console.error("Failed to save geocache:",e)}}async function l(e,t){try{let r=encodeURIComponent(`${e}, ${t}, USA`),o=`https://nominatim.openstreetmap.org/search?q=${r}&format=json&limit=1`,a=await fetch(o,{headers:{"User-Agent":"SaveThemNow.Jesus/1.0 (missing-persons-awareness)"}});if(!a.ok)return null;let s=await a.json();if(s&&s.length>0)return{lat:parseFloat(s[0].lat),lon:parseFloat(s[0].lon)};return null}catch(e){return console.error("Geocoding error:",e),null}}async function c(e,t){if(!e||!t)return null;let r=await n(),o=`${e},${t}`.toLowerCase();if(r[o])return{lat:r[o].lat,lon:r[o].lon};let a=await l(e,t);return a&&(r[o]={...a,timestamp:Date.now()},await i(r)),a}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),o=t.X(0,[276,972,915],()=>r(2225));module.exports=o})();